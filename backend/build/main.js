!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=8)}([function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("express")},function(e,t,i){const s=i(5);const{PRIVATE_KEY:a}=process.env;e.exports=function(e){return function(t,i,o){const r=t.cookies["x-access-token"];if(!r)return i.status(401).send("Access denied. No token provided.");try{const l=s.verify(r,a);if(l.highestAccess={},l.isAdmin?l.highestAccess.isAdmin=!0:l.isEmployee?l.highestAccess.isEmployee=!0:l.isCoach?l.highestAccess.isCoach=!0:l.isAthlete&&(l.highestAccess.isAthlete=!0),e){for(let i of e)if(l[i])return t.user=l,o();return i.status(401).send("Unauthorized to perform this action.")}return t.user=l,o()}catch(e){return i.status(400).clearCookie("x-access-token").send("Invalid token.")}}}},function(e,t,i){const s=i(14);e.exports=function(e,t){return function(i,a,o){let r=s.parse(i.url,!0).query;for(let i of e)if(!r[i])return a.status(400).json({message:`Missing required parameter: ${i}`,required:e,optional:t});return i.query=r,o()}}},function(e,t,i){"use strict";const{DB_HOST:s,DB_DATABASE:a,DB_USER:o,DB_PASSWORD:r}=process.env,l=i(6),n=i(0),{DataTypes:d}=i(0),u=new n(a,o,r,{host:s,pool:{max:10,min:0,acquire:3e4,idle:1e4},dialect:"postgres",logging:!1,dialectOptions:{options:{useUTC:!1,dateFirst:1}},define:{timestamps:!1}}),c=u.define("organizations",{name:{type:n.STRING,allowNull:!1},shortName:{type:n.STRING,allowNull:!0},address:{type:n.STRING,allowNull:!0},city:{type:n.STRING,allowNull:!0},state:{type:n.STRING,allowNull:!0},zip:{type:n.INTEGER,min:1e4,max:99999,allowNull:!0},phone:{type:n.INTEGER,allowNull:!0},primaryColor:{type:n.STRING(6),allowNull:!0},secondaryColor:{type:n.STRING(6),allowNull:!0},logo:{type:n.STRING,allowNull:!0}}),p=u.define("credentials",{email:{type:n.STRING,unique:!0,validate:{isEmail:!0},allowNull:!1},username:{type:n.STRING,unique:!0,allowNull:!1},password:{type:n.STRING,unique:!1,allowNull:!1},isAdmin:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},isEmployee:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},isAthlete:{type:n.BOOLEAN,allowNull:!1,defaultValue:!0},isCoach:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},isApproved:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},isVerified:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1}},{hooks:{beforeValidate:async(e,t)=>{e.username=e.username||e.email.split("@")[0]}}});c.hasMany(p,{foreignKey:{allowNull:!1}}),p.belongsTo(c);const y=u.define("users",{schoolId:{type:n.STRING,allowNull:!0},firstName:{type:n.STRING,allowNull:!0},lastName:{type:n.STRING,allowNull:!0},address:{type:n.STRING,allowNull:!0},city:{type:n.STRING,allowNull:!0},state:{type:n.STRING,allowNull:!0},zip:{type:n.INTEGER,min:1e4,max:99999,allowNull:!0},phone:{type:n.INTEGER,allowNull:!0},lockerNumber:{type:n.INTEGER,allowNull:!0},lockerCode:{type:n.INTEGER,allowNull:!0},gender:{type:n.STRING(1),allowNull:!0},height:{type:n.INTEGER,comment:"in inches",allowNull:!0},weight:{type:n.INTEGER,comment:"in pounds",allowNull:!0},active:{type:n.BOOLEAN,allowNull:!1,defaultValue:!0}},{timestamps:!0});p.hasOne(y,{foreignKey:{allowNull:!1,unique:!0},onDelete:"CASCADE"}),y.belongsTo(p,{foreignKey:{allowNull:!1,unique:!0},onDelete:"CASCADE"}),c.hasMany(y,{foreignKey:{allowNull:!1}}),y.belongsTo(c,{foreignKey:{allowNull:!1}});const m=u.define("statuses",{name:{type:n.STRING,allowNull:!1},academicYear:{type:n.INTEGER,allowNull:!0}});m.hasMany(y),y.belongsTo(m);const h=u.define("sports",{name:{type:n.STRING,allowNull:!1},gender:{type:n.STRING(1),allowNull:!0},icon:{type:n.STRING,allowNull:!0},default:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1}});c.hasMany(h,{foreignKey:{allowNull:!1}}),h.belongsTo(c,{foreignKey:{allowNull:!1}});const w=u.define("sportSizes",{name:{type:n.STRING,allowNull:!1},sizes:{type:n.JSON,allowNull:!1,defaultValue:[]}},{timestamps:!1});h.hasMany(w,{foreignKey:{allowNull:!1}}),w.belongsTo(h,{foreignKey:{allowNull:!1}});const g=u.define("userSports",{});y.belongsToMany(h,{through:"userSports"}),h.belongsToMany(y,{through:"userSports"});const I=u.define("teams",{name:{type:n.STRING,allowNull:!1},description:{type:n.STRING,allowNull:!0},schoolYear:{type:n.INTEGER,allowNull:!0},season:{type:d.STRING,allowNull:!0}});h.hasMany(I,{foreignKey:{allowNull:!1}}),I.belongsTo(h,{foreignKey:{allowNull:!1}});const f=u.define("teamMembers",{});y.belongsToMany(I,{through:"teamMembers"}),I.belongsToMany(y,{through:"teamMembers"});const N=u.define("inventories",{name:{type:n.STRING,allowNull:!1},description:{type:n.STRING,allowNull:!0},surplus:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},taxable:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},expendable:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},totalQuantity:{type:n.VIRTUAL},averagePrice:{type:n.VIRTUAL}},{timestamps:!0,hooks:{afterFind:async(e,t)=>{if(e.length)for(let t in e)e[t].totalQuantity=await A.sum("quantity",{where:{inventoryId:e[t].id}}),e[t].averagePrice=await A.sum("price",{where:{inventoryId:e[t].id}})/await A.count({where:{inventoryId:e[t].id}});else e.totalQuantity=await A.sum("quantity",{where:{inventoryId:e.id}}),e.averagePrice=await A.sum("price",{where:{inventoryId:e.id}})/await A.count({where:{inventoryId:e.id}})}}});w.hasMany(N,{foreignKey:{allowNull:!1}}),N.belongsTo(w,{foreignKey:{allowNull:!1}}),c.hasMany(N,{foreignKey:{allowNull:!1}}),N.belongsTo(c,{foreignKey:{allowNull:!1}});const A=u.define("inventorySizes",{size:{type:n.STRING,allowNull:!1},barcode:{type:n.STRING,allowNull:!0},price:{type:n.DECIMAL,allowNull:!0},quantity:{type:n.INTEGER,allowNull:!1,defaultValue:0}},{timestamps:!0});N.hasMany(A,{foreignKey:{allowNull:!1}}),A.belongsTo(N,{foreignKey:{allowNull:!1}});const b=u.define("equipment",{count:{type:n.INTEGER,allowNull:!1}},{timestamps:!0});y.hasMany(b,{foreignKey:{allowNull:!1}}),b.belongsTo(y,{foreignKey:{allowNull:!1}}),A.hasMany(b,{foreignKey:{allowNull:!1}}),b.belongsTo(A,{foreignKey:{allowNull:!1}}),c.hasMany(b,{foreignKey:{allowNull:!1}}),b.belongsTo(c,{foreignKey:{allowNull:!1}});const z=u.define("transactions",{amount:{type:n.INTEGER,allowNull:!1},returned:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1}},{timestamps:!0});b.hasMany(z,{foreignKey:{allowNull:!1}}),z.belongsTo(b,{foreignKey:{allowNull:!1}}),y.hasMany(z,{as:"IssuedBy",foreignKey:{name:"issuedBy",allowNull:!1}}),z.belongsTo(y,{as:"IssuedBy",foreignKey:{name:"issuedBy",allowNull:!1}}),y.hasMany(z,{as:"IssuedTo",foreignKey:{name:"issuedTo",allowNull:!1}}),z.belongsTo(y,{as:"IssuedTo",foreignKey:{name:"issuedTo",allowNull:!1}}),c.hasMany(z,{foreignKey:{allowNull:!1}}),z.belongsTo(c,{foreignKey:{allowNull:!1}});const q=u.define("userSizes",{size:{type:n.STRING,allowNull:!1}},{timestamps:!1});y.hasMany(q,{foreignKey:{allowNull:!1}}),q.belongsTo(y,{foreignKey:{allowNull:!1}}),w.hasMany(q,{foreignKey:{allowNull:!1}}),q.belongsTo(w,{foreignKey:{allowNull:!1}}),e.exports={User:y,Inventory:N,InventorySize:A,Equipment:b,Transaction:z,UserSize:q,UserSport:g,Sport:h,SportSize:w,Status:m,Credential:p,hashPassword:async e=>await(await l.hash(e,10)),Organization:c,Team:I,TeamMember:f,db:u}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcrypt")},function(e,t,i){"use strict";const s=i(1),a=i(0),{Sport:o,UserSport:r,User:l}=i(4),n=i(2),d=i(3),u=s.Router();async function c(e,t){t=t.map(e=>e.id||e);try{let i=await o.findAll({where:{default:!1},include:[{model:l,where:{id:e},attributes:[]}]}).map(e=>e.id),s=t.filter(e=>!i.includes(e)),a=i.filter(e=>!t.includes(e));for(let t of s)await r.create({userId:e,sportId:t});for(let t of a)await r.destroy({where:{userId:e,sportId:t}});return(await l.findOne({where:{id:e},include:[{model:o,through:{attributes:[]},attributes:{exclude:["organizationId"]}}]})).sports}catch(e){return console.log(e),e}}u.post("/",n(["isAdmin"]),async(e,t,i)=>{const s=e.body;try{let i=await o.create({name:s.name,gender:s.gender,icon:s.icon,organizationId:e.user.organizationId});t.json(i)}catch(e){i(e)}}),u.get("/",n(),d([],["id"]),async(e,t,i)=>{try{let i=await o.findAll({where:a.and({organizationId:e.user.organizationId},e.query.id?{id:e.query.id}:null),attributes:{exclude:["organizationId"]}});t.json(e.query.id&&i.length?i[0]:i)}catch(e){i(e)}}),u.put("/",n(["isAdmin"]),d(["id"]),async(e,t,i)=>{const s=e.body;try{await o.update({name:s.name,gender:s.gender,icon:s.icon},{where:{id:e.query.id,organizationId:e.user.organizationId}});let i=await o.findOne({where:{id:e.query.id},attributes:{exclude:["organizationId"]}});t.json(i)}catch(e){i(e)}}),u.put("/user",n(["isAdmin","isEmployee"]),d(["userId"]),async(e,t,i)=>{t.json(await c(e.query.userId,e.body.sports))}),e.exports={sportRouter:u,updateUserSports:c}},function(e,t,i){"use strict";const s=i(1),a=(i(9),i(10)),o=i(11),r=i(12),l=i(13),{sportRouter:n}=i(7),d=i(15),u=i(16),c=i(17);const{PORT:p,API_VER:y}=process.env,m=s();var h=["https://aims-frontend-blkgoerjhq-uc.a.run.app"],w={origin:function(e,t){-1===h.indexOf(e)&&e?t(new Error("Not allowed by CORS")):t(null,!0)},methods:"GET,PUT,POST,DELETE",allowedHeaders:["authorization","x-access-token","Content-Type","Accept","Origin","X-Request-With"],credentials:!0};m.use(o(w)),m.use(s.json({limit:"50mb"})),m.use(s.urlencoded({extended:!0,limit:"10mb"})),m.use(a()),m.use(r()),m.get("/",(e,t)=>{t.json({message:"Welcome to the AIMS API"})});const g=`/api/v${y}/`;m.use(g+"credentials",d),m.use(g+"users",l),m.use(g+"sports",n),m.use(g+"inventory",u),m.use(g+"equipment",c),m.use("*",(e,t,i)=>{t.setHeader("Content-Type","application/json"),i()}),m.use((e,t)=>{t.status(404).send("Route not found.")}),m.use((e,t,i,s)=>{i.status(500).json({message:e.message,error:{}})}),m.set("port",p||5e3);m.listen(m.get("port"),()=>{console.info(`Server listening on localhost:${m.get("port")}`)})},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("helmet")},function(e,t,i){"use strict";const s=i(1),a=i(0),o=i(2),r=i(3),{User:l,UserSport:n,Sport:d,UserSize:u,Credential:c,SportSize:p,Status:y,hashPassword:m}=i(4),h=s.Router(),{updateUserSports:w}=i(7);h.post("/",o(["isAdmin"]),async(e,t,i)=>{const s=e.body;try{let i=await c.create({email:s.email,username:s.username,password:await m(s.password||"password123"),organizationId:e.user.organizationId}),a=await l.create({schoolId:s.schoolId,firstName:s.firstname,lastName:s.lastName,address:s.address,city:s.city,state:s.state,zip:s.zip,phone:s.phone,gender:s.gender,height:s.height,weight:s.weight,lockerNumber:s.lockerNumber,lockerCode:s.lockerCode,credentialId:i.id,organizationId:e.user.organizationId});await d.findOne({where:{organizationId:e.user.organizationId,default:!0}}).then(async e=>{await n.create({userId:a.id,sportId:e.id})}),s.sports&&w(a.id,s.sports),t.json(a)}catch(e){i(e)}}),h.get("/",o(["isAdmin","isEmployee","isCoach"]),r([],["page","limit","id","gender","sports[]","isAdmin","isEmployee","isCoach","isAthlete"]),async(e,t,i)=>{try{let i=[];e.user.highestAccess.isCoach&&(i=await n.findAll({where:{userId:e.user.id},attributes:["sportId"]}).map(e=>e.sportId));const s=e.query.page*e.query.limit||0;e.query.limit;let o=await l.findAll({offset:s,where:a.and({organizationId:e.user.organizationId},e.query.id?{id:e.query.id}:null,e.query.gender?{gender:e.query.gender}:null),attributes:{exclude:["createdAt","updatedAt","credentialId","organizationId","statusId"]},include:[{model:d,attributes:["id","name","gender"],through:{attributes:[]},where:a.and(e.query["sports[]"]?a.or({id:e.query["sports[]"]}):null,e.user.highestAccess.isCoach?a.or({id:i}):null),include:[{model:p,attributes:e.query.id?["sportId","name","sizes"]:[]}]},{model:u,attributes:e.query.id?["id","sportSizeId","size"]:[]},{model:c,attributes:e.user.isAdmin?{exclude:["organizationId","password"]}:["email","username"],where:e.query.isAdmin||e.query.isEmployee||e.query.isCoach||e.query.isAthlete?a.or(e.query.isAdmin?{isAdmin:e.query.isAdmin}:null,e.query.isEmployee?{isEmployee:e.query.isEmployee}:null,e.query.isCoach?{isCoach:e.query.isCoach}:null,e.query.isAthlete?{isAthlete:e.query.isAthlete}:null):null},{model:y}]});t.json(e.query.id&&o.length?o[0]:o)}catch(e){i(e)}}),h.get("/current",o(),async(e,t,i)=>{try{let i=await l.findOne({where:{credentialId:e.user.id},attributes:{exclude:["createdAt","updatedAt","credentialId","organizationId","statusId"]},include:[{model:d,attributes:["id","name","gender"],through:{attributes:[]},include:[{model:p,attributes:["sportId","name","sizes"]}]},{model:u,attributes:["id","sportSizeId","size"]},{model:c,attributes:e.user.isAdmin?{exclude:["organizationId","password"]}:["email","username"]},{model:y}]});t.json(i)}catch(e){i(e)}}),h.put("/current",o(),async(e,t,i)=>{let s=e.body;try{let i=await l.findOne({where:{credentialId:e.user.id}});e.user.isAdmin&&(i.schoolId=s.schoolId),(e.user.isAdmin||e.user.isEmployee)&&(i.lockerNumber=s.lockerNumber,i.lockerCode=s.lockerCode,s.sports&&w(i.id,s.sports)),i.firstName=s.firstname,i.lastName=s.lastName,i.address=s.address,i.city=s.city,i.state=s.state,i.zip=s.zip,i.phone=s.phone,i.gender=s.gender,i.height=s.height,i.weight=s.weight,await i.save(),t.json(i)}catch(e){i(e)}}),h.put("/",o(["isAdmin","isEmployee"]),r(["id"]),async(e,t,i)=>{let s=e.body;try{let i=await l.findOne({where:{id:e.query.id}});e.user.isAdmin&&(i.schoolId=s.schoolId),s.sports&&w(i.id,s.sports),i.lockerNumber=s.lockerNumber,i.lockerCode=s.lockerCode,i.firstName=s.firstname,i.lastName=s.lastName,i.address=s.address,i.city=s.city,i.state=s.state,i.zip=s.zip,i.phone=s.phone,i.gender=s.gender,i.height=s.height,i.weight=s.weight,await i.save(),t.json(i)}catch(e){i(e)}}),e.exports=h},function(e,t){e.exports=require("url")},function(e,t,i){"use strict";const s=i(1),{Credential:a,Organization:o,User:r,Sport:l,UserSport:n,hashPassword:d}=i(4),u=i(2),c=i(3),p=i(5),y=i(6),m=i(0),h=s.Router();const{PRIVATE_KEY:w}=process.env;h.get("/current",u(),async(e,t,i)=>{try{let i=await a.findOne({where:{id:e.user.id},attributes:["email","username","isAdmin","isEmployee","isAthlete","isCoach","isVerified","isApproved"],include:{model:o}});t.json(i)}catch(e){i(e)}}),h.post("/signup",async(e,t,i)=>{const s=e.body;try{let e=await a.create({email:s.email,username:s.username,password:await d(s.password),organizationId:s.organizationId||1}),i=await r.create({credentialId:e.id,organizationId:e.organizationId});await l.findOne({where:{organizationId:e.organizationId,default:!0}}).then(async e=>{await n.create({userId:i.id,sportId:e.id})});let u=await o.findOne({where:{id:e.organizationId}});const c=await p.sign({id:e.id,organizationId:e.organizationId,isAdmin:e.isAdmin,isEmployee:e.isEmployee,isAthlete:e.isAthlete,isCoach:e.isCoach},w,{expiresIn:"30d"});t.status(201).cookie("x-access-token",c,{expires:s.remember?new Date(Date.now()+2592e6):0,httpOnly:!0}).json({email:e.email,username:e.username,isAdmin:e.isAdmin,isEmployee:e.isEmployee,isCoach:e.isCoach,isAthlete:e.isAthlete,isVerified:e.isVerified,isApproved:e.isApproved,organization:u})}catch(e){t.status(401).send("Email or username already in use.")}}),h.post("/login",async(e,t,i)=>{const s=e.body;try{let e=await a.findOne({where:m.or({email:s.email},{username:s.username?s.username:s.email.split("@")[0]}),include:{model:o}});e?await y.compare(s.password,e.password,(i,a)=>{if(a){let i=p.sign({id:e.id,organizationId:e.organizationId,isAdmin:e.isAdmin,isEmployee:e.isEmployee,isAthlete:e.isAthlete,isCoach:e.isCoach},w,{expiresIn:"30d"});t.cookie("x-access-token",i,{expires:s.remember?new Date(Date.now()+2592e6):0,httpOnly:!0}).json({email:e.email,username:e.username,isAdmin:e.isAdmin,isEmployee:e.isEmployee,isCoach:e.isCoach,isAthlete:e.isAthlete,isVerified:e.isVerified,isApproved:e.isApproved,organization:e.organization})}else t.status(401).send("Credentials not valid")}):t.status(401).send("Credentials not found")}catch(e){i(e)}}),h.get("/logout",async(e,t,i)=>{t.status(200).clearCookie("x-access-token").send("User has been logged out.")}),h.put("/current",u(),async(e,t,i)=>{let s=e.body;try{let i=await a.findOne({where:{id:e.user.id}});if(i.email=s.email||i.email,i.username=s.username||i.username,e.user.isAdmin){i.isEmployee=!0===s.isEmployee||!1===s.isEmployee?s.isEmployee:i.isEmployee,i.isCoach=!0===s.isCoach||!1===s.isCoach?s.isCoach:i.isCoach,i.isAthlete=!0===s.isAthlete||!1===s.isAthlete?s.isAthlete:i.isAthlete,await i.save();let e=p.sign({id:i.id,organizationId:i.organizationId,isAdmin:i.isAdmin,isEmployee:i.isEmployee,isAthlete:i.isAthlete,isCoach:i.isCoach},w,{expiresIn:"30d"});t.cookie("x-access-token",e,{expires:0,httpOnly:!0})}t.send("Credential update successful")}catch(e){i(e)}}),h.put("/",u(["isAdmin"]),c(["id"]),async(e,t,i)=>{let s=e.body;try{let i=await a.findOne({where:{id:e.query.id}});i.email=s.email||i.email,i.username=s.username||i.username,e.user.id!==i.id&&(i.isAdmin=!0===s.isAdmin||!1===s.isAdmin?s.isAdmin:i.isAdmin),i.isEmployee=!0===s.isEmployee||!1===s.isEmployee?s.isEmployee:i.isEmployee,i.isCoach=!0===s.isCoach||!1===s.isCoach?s.isCoach:i.isCoach,i.isAthlete=!0===s.isAthlete||!1===s.isAthlete?s.isAthlete:i.isAthlete,await i.save(),t.send("Credential update successful")}catch(e){i(e)}}),h.put("/changePassword",u(),async(e,t,i)=>{const s=e.body;try{let i=await a.findOne({where:{id:e.user.id}});i?await y.compare(s.password,i.password,async(e,a)=>{a?s.password!==s.newPassword?(i.password=await d(s.newPassword),await i.save(),t.send("Password successfully changed.")):t.status(400).send("Password cannot match previous password."):t.status(401).send("Credentials not valid")}):t.status(401).send("Credentials not found")}catch(e){i(e)}}),e.exports=h},function(e,t,i){"use strict";const s=i(1),a=i(0),o=i(3),{Inventory:r,InventorySize:l,SportSize:n,Sport:d}=i(4),u=i(2),c=s.Router();c.get("/",u(["isAdmin","isEmployee","isCoach"]),o([],["page","limit","id","surplus","sportSizeId","sports[]","gender","taxable","expendable"]),async(e,t,i)=>{try{const i=e.query.page*e.query.limit||0,s=e.query.limit||200;let o=await r.findAll({offset:i,limit:s,where:a.and(e.query.id?{id:e.query.id}:null,{organizationId:e.user.organizationId},e.query.surplus?{surplus:e.query.surplus}:null,e.query.sportSizeId?{sportSizeId:e.query.sportSizeId}:null,e.query.taxable?{taxable:e.query.taxable}:null,e.query.expendable?{expendable:e.query.expendable}:null),attributes:{exclude:["createdAt","updatedAt","sportSizeId","organizationId"]},include:[{model:n,where:a.and(e.query.sportSizeId?{id:e.query.sportSizeId}:null,e.query["sports[]"]?a.or({sportId:e.query["sports[]"]}):null),attributes:{exclude:e.query.id?["sportId"]:["sportId","sizes"]},include:[{model:d,where:a.and(e.query.gender?{gender:e.query.gender}:null),attributes:{exclude:["organizationId"]}}]},{model:l,attributes:e.query.id?["id","size","barcode","price","quantity"]:[]}]});t.json(e.query.id&&o.length?o[0]:o)}catch(e){i(e)}}),c.post("/",u(["isAdmin","isEmployee"]),async(e,t,i)=>{let s=e.body;try{let i=await r.create({name:s.name,description:s.description,surplus:s.surplus,taxable:s.taxable,expendable:s.expendable,organizationId:e.user.organizationId,sportSizeId:s.sportSizeId});for(let e of s.inventorySizes)await l.create({size:e.size,barcode:e.barcode,price:e.price,quantity:e.quantity,inventoryId:i.id});t.status(201).json(await r.findOne({where:{id:i.id},attributes:{exclude:["createdAt","updatedAt","sportSizeId","organizationId"]},include:[{model:l,attributes:{exclude:["createdAt","updatedAt","inventoryId"]}},{model:n,attributes:{exclude:["sportId"]},include:[{model:d,attributes:{exclude:["organizationId"]}}]}]}))}catch(e){i(e)}}),c.put("/",u(["isAdmin","isEmployee"]),o(["id"]),async(e,t,i)=>{let s=e.body;try{let i=await r.findOne({where:{id:e.query.id},attributes:{exclude:["createdAt","updatedAt","sportSizeId","organizationId"]},include:[{model:l,attributes:{exclude:["createdAt","updatedAt","inventoryId"]}},{model:n,attributes:{exclude:["sportId"]},include:[{model:d,attributes:{exclude:["organizationId"]}}]}]});i.name=s.name,i.description=s.description,i.surplus=s.surplus,i.taxable=s.taxable,i.expendable=s.expendable,i.sportSizeId=s.sportSizeId,await i.save();let a=s.inventorySizes.filter(e=>!e.id),o=i.inventorySizes.filter(e=>0===s.inventorySizes.filter(t=>t.id===e.id).length),u=s.inventorySizes.filter(e=>e.id);for(let e of u)await l.update({size:e.size,barcode:e.barcode,price:e.price,quantity:e.quantity},{where:{id:e.id}});for(let e of a)await l.create({size:e.size,barcode:e.barcode,price:e.price,quantity:e.quantity,inventoryId:i.id});for(let e of o)await l.destroy({where:{id:e.id}});t.json(await i.reload())}catch(e){i(e)}}),e.exports=c},function(e,t,i){"use strict";const s=i(1),a=i(0),{Equipment:o,InventorySize:r,Inventory:l,SportSize:n,Sport:d,User:u,UserSport:c}=i(4),p=i(2),y=i(3),m=s.Router();m.get("/",p(["isAdmin","isEmployee","isCoach"]),y([],["page","limit","userId","sports[]","sportSizeId","inventoryId","taxable","surplus","expendable"]),async(e,t,i)=>{try{let i=[];e.user.highestAccess.isCoach&&(i=await c.findAll({where:{userId:e.user.id},attributes:["sportId"]}).map(e=>e.sportId));let s=await o.findAll({where:a.and(e.query.userId?{userId:e.query.userId}:null),attributes:{exclude:["createdAt","updatedAt","inventorySizeId","organizationId"]},include:[{model:r,attributes:{exclude:["createdAt","updatedAt","inventoryId"]},where:a.and(e.query.inventoryId?{inventoryId:e.query.inventoryId}:null),include:{model:l,attributes:{exclude:["createdAt","updatedAt","sportSizeId","organizationId"]},where:a.and(e.query.inventoryId?{id:e.query.inventoryId}:null,e.query.taxable?{taxable:e.query.taxable}:null,e.query.surplus?{surplus:e.query.surplus}:null,e.query.expendable?{expendable:e.query.expendable}:null),include:[{model:n,attributes:{exclude:["sportId"]},where:a.and(e.query.sportSizeId?{id:e.query.sportSizeId}:null,e.query["sports[]"]?a.or({sportId:e.query["sports[]"]}):null,e.user.highestAccess.isCoach?a.or({id:i}):null),include:[{model:d,where:a.and(e.query["sports[]"]?a.or({id:e.query["sports[]"]}):null,e.user.highestAccess.isCoach?a.or({id:i}):null),attributes:{exclude:["organizationId"]}}]}]}}]});t.json(e.query["sports[]"]||e.query.sportSizeId?s.filter(e=>e.inventorySize.inventory):e.query.taxable||e.query.surplus||e.query.expendable?s.filter(e=>e.inventorySize):s)}catch(e){i(e)}}),m.get("/current",p(),async(e,t,i)=>{try{let i=await u.findOne({where:{credentialId:e.user.id}}),s=await o.findAll({where:{userId:i.id},attributes:{exclude:["createdAt","updatedAt","inventorySizeId","organizationId"]},include:[{model:r,attributes:{exclude:["createdAt","updatedAt","inventoryId"]},include:{model:l,attributes:{exclude:["createdAt","updatedAt","sportSizeId","organizationId"]},include:[{model:n,attributes:{exclude:["sportId"]},include:[{model:d,attributes:{exclude:["organizationId"]}}]}]}}]});t.json(s)}catch(e){i(e)}}),e.exports=m}]);